<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">

  <h:body>
    <ui:composition template="../templates/super_template.xhtml">
      <ui:define name="main-body">
        
        <h:form id="form">  
          
          <p:growl id="msgs" showDetail="true"/>
          
          <p:dataTable id="Solicitudes" var="usuario" value="#{usuarioBean.listaUsuarios}" rowKey="#{usuario}"
                       paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                       editable="true"  paginator="true" rows="2"   rowsPerPageTemplate="2,4,30,40,50,100,1000"
                       widgetVar="usuariosTable"  emptyMessage="No se encontraron datos." >  

            <f:facet name="header" class="filter-bar">  
              <p:commandButton  value="Nuevo Usuario" type="button" onclick="PF('newUser').show();" />
              
              FILTROS
            </f:facet>    
            <p:ajax event="rowEdit" listener="#{usuarioBean.onRowEdit}" update=":form:msgs" />
            <p:ajax event="rowEditCancel" listener="#{usuarioBean.onRowCancel}" update=":form:msgs" />

            <p:column filterBy="#{usuario.apellido}"  headerText="Apellidos" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{usuario.apellido}" /></f:facet>
                <f:facet name="input"><p:inputText value="#{usuario.apellido}" style="width:100%"/></f:facet>
              </p:cellEditor>
            </p:column>

            <p:column filterBy="#{usuario.nombre}"  headerText="Nombres" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{usuario.nombre}" /></f:facet>
                <f:facet name="input"><p:inputText value="#{usuario.nombre}" style="width:100%"/></f:facet>
              </p:cellEditor>
            </p:column>

            <p:column filterBy="#{usuario.cedula}"  headerText="Cédula" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{usuario.cedula}" /></f:facet>
                <f:facet name="input"><p:inputText value="#{usuario.cedula}" style="width:100%"/></f:facet>
              </p:cellEditor>
            </p:column>
            
            <p:column filterBy="#{usuario.email}"  headerText="Email" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{usuario.email}" /></f:facet>
                <f:facet name="input"><p:inputText value="#{usuario.email}" style="width:100%"/></f:facet>
              </p:cellEditor>
            </p:column>
            
            <p:column filterBy="#{usuario.telefono}"  headerText="Telefono" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{usuario.telefono}" /></f:facet>
                <f:facet name="input"><p:inputText value="#{usuario.telefono}" style="width:100%"/></f:facet>
              </p:cellEditor>
            </p:column>
            
            <p:column filterBy="#{usuario.rol}"  
                      headerText="Rol" 
                      filterMatchMode="contains">  
              <h:outputText value="#{usuario.rol}" />  
            </p:column>

            <p:column style="width:32px">
              <p:rowEditor />
            </p:column>

          </p:dataTable>  
        </h:form>  
          
        <p:dialog widgetVar="newUser"  minHeight="40" closeOnEscape="true" draggable="false" resizable="false" showEffect="drop" hideEffect="drop">
          <h:form>          
          <center>
            <p:panel id="pnl" style="margin-bottom:10px;">
              <p:messages id="messages" />
              <h:panelGrid columns="3" cellpadding="5">
                <h:outputLabel for="apellido" value="Apellido: *" />
                <p:inputText id="apellido" value="#{usuarioBean.usuario.apellido}" required="true" label="Apellido" requiredMessage="El appellido debe contener más de 2 letras.">
                  <f:validateLength minimum="2" />
                </p:inputText>
                <p:message for="apellido" />

                <h:outputLabel for="nombre" value="Nombre: *" />
                <p:inputText id="nombre" value="#{usuarioBean.usuario.nombre}" required="true" label="Nombre">
                  <f:validateLength minimum="2" />
                </p:inputText>
                <p:message for="nombre" />

                <h:outputLabel for="cedula" value="Cédula: *" />
                <p:inputText id="cedula" value="#{usuarioBean.usuario.cedula}" required="true" label="Cédula">
                  <f:validateLength minimum="10" />
                </p:inputText>
                <p:message for="cedula" />

                <h:outputLabel for="clave" value="Clave: *" />
                <p:inputText id="clave" value="#{usuarioBean.usuario.clave}" required="true" label="Clave">
                  <f:validateLength minimum="5" />
                </p:inputText>
                <p:message for="clave" />

                <h:outputLabel for="email" value="Email: *" />
                <p:inputText id="email" value="#{usuarioBean.usuario.email}" required="true" label="Email">
                  <f:validateLength minimum="5" />
                  <f:validateRegex pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
                </p:inputText>
                <p:message for="email" />

                <h:outputLabel for="telefono" value="Teléfono: *" />
                <p:inputText id="telefono" value="#{usuarioBean.usuario.telefono}" required="false" label="telefono">
                  <f:validateLength minimum="7" />
                </p:inputText>
                <p:message for="telefono" />

                <h:outputText value="Estado: " />
                <p:selectBooleanCheckbox value="#{usuarioBean.usuario.estado}" />

                <h:outputLabel for="rol" value="Rol: *" />
                <p:inputText id="rol" value="#{usuarioBean.usuario.rol}" required="true" label="Rol">
                  <f:validateLength minimum="5" />
                </p:inputText>
                <p:message for="rol" />

                <!--              <p:outputLabel for="rol" value="Rol:" />
                              <p:selectOneRadio id="console" value="{usuarioBean.usuario.rol}">
                                  <f:selectItem itemLabel="Administrador" itemValue="admin" />
                                  <f:selectItem itemLabel="Superadministrador" itemValue="super" />
                              </p:selectOneRadio>-->
                <f:facet name="footer">
                  <center>
                    <h:commandButton value="Guardar"  action="#{usuarioBean.saveUsuario()}"/>
                  </center>
                </f:facet> 

              </h:panelGrid>
            </p:panel>
          </center>
        </h:form>
        </p:dialog>
      </ui:define>
    </ui:composition>
  </h:body>
</html>
