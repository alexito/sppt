<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">

  <h:body>
    <ui:composition template="../templates/super_template.xhtml">
      <ui:define name="main-body">

        <h:form id="form">  

          <p:growl id="msgs" showDetail="true"/>

          <p:menubar>
            <p:submenu label="Administrar">              
              <p:menuitem icon="ui-icon-person" value="Usuarios" url="/views/super/usuarios.jspx" />
              <p:menuitem icon="ui-icon-check" value="Solicitudes" url="/views/admin/solicitudes.jspx" />
              <p:menuitem icon="ui-icon-key" value="Cambiar clave" url="/administration/CambiarPassword/CambiarPassword.jspx" />
            </p:submenu>
            <p:menuitem icon="ui-icon-person" value="Nuevo Conductor"  onclick="PF('newUser').show();" />
            <f:facet name="options">
              <p:commandButton type="button" value="Salir" icon="ui-icon-extlink" />
            </f:facet>
          </p:menubar>

          <p:dataTable id="Solicitudes" var="usuario" value="#{usuarioBean.listaConductores}" rowKey="#{usuario}"
                       paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                       editable="true"  paginator="true" rows="10"   rowsPerPageTemplate="10,20,30,40,50,100,1000"
                       widgetVar="usuariosTable"  emptyMessage="No se encontraron datos." >  

            <p:ajax event="rowEdit" listener="#{usuarioBean.onRowEdit}" update=":form:msgs" />
            <p:ajax event="rowEditCancel" listener="#{usuarioBean.onRowCancel}" update=":form:msgs" />

            <p:column filterBy="#{usuario.apellido}" sortBy="#{usuario.apellido}" headerText="Apellidos" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{usuario.apellido}" /></f:facet>
                <f:facet name="input">
                  <p:inputText id="apellido" value="#{usuario.apellido}" required="true" requiredMessage="El apellido es obligatorio." style="width: 100%;">
                    <f:validateLength minimum="2" />
                    <p:ajax update="msgApellido" event="keyup" />
                  </p:inputText>                
                  <p:message for="apellido" id="msgApellido" display="icon" />
                </f:facet>
              </p:cellEditor>
            </p:column>

            <p:column filterBy="#{usuario.nombre}" sortBy="#{usuario.nombre}"  headerText="Nombres" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{usuario.nombre}" /></f:facet>
                <f:facet name="input">
                  <p:inputText id="nombre" value="#{usuario.nombre}" required="true" requiredMessage="La nombre es obligatorio." style="width:100%">
                    <f:validateLength minimum="2" />
                    <p:ajax update="msgNombre" event="keyup" />
                  </p:inputText>                
                  <p:message for="nombre" id="msgNombre" display="icon" />
                </f:facet>
              </p:cellEditor>
            </p:column>

            <p:column filterBy="#{usuario.cedula}"  headerText="Cédula" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{usuario.cedula}" /></f:facet>
                <f:facet name="input">
                  <p:inputText id="cedula" value="#{usuario.cedula}" required="true" requiredMessage="La cédula es obligatoria." style="width:100%">
                    <f:validateLength minimum="10" />
                    <p:ajax update="msgCedula" event="keyup" />
                  </p:inputText>                
                  <p:message for="cedula" id="msgCedula" display="icon" />
                </f:facet>
              </p:cellEditor>
            </p:column>

            <p:column filterBy="#{usuario.email}"  headerText="Email" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{usuario.email}" /></f:facet>
                <f:facet name="input">
                  <p:inputText id="email" value="#{usuario.email}" required="true" requiredMessage="El email es obligatorio." style="width:100%">
                    <f:validateLength minimum="5" for="email" />
                    <f:validateRegex pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
                    <p:ajax update="msgEmail" event="keyup" />
                  </p:inputText>                
                  <p:message for="email" id="msgEmail" display="icon" />
                </f:facet>
              </p:cellEditor>
            </p:column>

            <p:column filterBy="#{usuario.telefono}"  headerText="Telefono" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{usuario.telefono}" /></f:facet>
                <f:facet name="input">
                  <p:inputText id="telefono" value="#{usuario.telefono}" required="false" requiredMessage="El telefono es obligatorio." style="width:100%">
                    <f:validateLength minimum="7" />
                    <p:ajax update="msgTelefono" event="keyup" />
                  </p:inputText>                
                  <p:message for="telefono" id="msgTelefono" display="icon" />
                </f:facet>
              </p:cellEditor>
            </p:column>

            <p:column headerText="Estado" sortBy="#{usuario.estado_legible}">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{usuario.estado_legible}" /></f:facet>
                <f:facet name="input"><p:selectBooleanCheckbox value="#{usuario.estado}" style="margin-left: 45%" /></f:facet>
              </p:cellEditor>
            </p:column>

            <p:column style="width:50px">               
              <p:rowEditor id="editrow" />              
            </p:column>          
          </p:dataTable>  


        </h:form>  


        <!-- ________________________   NEW USER FORM  ________________________   -->


        <p:dialog widgetVar="newUser" header="Ingrese los datos del Nuevo Conductor"  closeOnEscape="true" draggable="false" resizable="false" showEffect="drop" hideEffect="drop">
          <h:form>          
            <center>
              <p:panel id="pnl" style="margin-bottom:10px;">
                <p:messages id="messages" />
                <h:panelGrid id="grid" columns="3" cellpadding="5">
                  <h:outputLabel for="apellido" value="Apellido: *" />
                  <p:inputText id="apellido" value="#{usuarioBean.conductor.apellido}" required="true" requiredMessage="El apellido es obligatorio." style="width:100%">
                    <f:validateLength minimum="2" />
                    <p:ajax update="msgApellido" event="keyup" />
                  </p:inputText>                
                  <p:message for="apellido" id="msgApellido" display="icon" />

                  <h:outputLabel for="nombre" value="Nombre: *" />
                  <p:inputText id="nombre" value="#{usuarioBean.conductor.nombre}" required="true" requiredMessage="El nombre es obligatorio." style="width:100%">
                    <f:validateLength minimum="2" />
                    <p:ajax update="msgNombre" event="keyup" />
                  </p:inputText>                
                  <p:message for="nombre" id="msgNombre" display="icon" />

                  <h:outputLabel for="cedula" value="Cédula: *" />
                  <p:inputText id="cedula" value="#{usuarioBean.conductor.cedula}" required="true" requiredMessage="La cédula es obligatoria." style="width:100%">
                    <f:validateLength minimum="10" />
                    <p:ajax update="msgCedula" event="keyup" />
                  </p:inputText>                
                  <p:message for="cedula" id="msgCedula" display="icon" />

                  <h:outputLabel for="email" value="Email: *" />
                  <p:inputText id="email" value="#{usuarioBean.conductor.email}" required="true" requiredMessage="El email es obligatorio." style="width:100%">
                    <f:validateLength minimum="5" />
                    <f:validateRegex for="email" pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
                    <p:ajax update="msgEmail" event="keyup" />
                  </p:inputText>                
                  <p:message for="email" id="msgEmail" display="icon" />

                  <h:outputLabel for="telefono" value="Teléfono: *" />
                  <p:inputText id="telefono" value="#{usuarioBean.conductor.telefono}" required="false" requiredMessage="El teléfono es obligatorio." style="width:100%">
                    <f:validateLength minimum="7" />
                    <p:ajax update="msgTelefono" event="keyup" />
                  </p:inputText>                
                  <p:message for="telefono" id="msgTelefono" display="icon" />

                  <h:outputLabel value="Estado: " />
                  <p:selectBooleanCheckbox id="estado" value="#{usuarioBean.conductor.estado}" />
                  <p:message for="estado" id="msgEstado" display="icon" />

                </h:panelGrid>
                <f:facet name="footer">
                  <center>
                    <p:commandButton ajax="true" update="grid" validateClient="true" value="Guardar"  action="#{usuarioBean.saveConductor()}"/>
                  </center>
                </f:facet> 
              </p:panel>
            </center>
          </h:form>
        </p:dialog>
      </ui:define>
    </ui:composition>
  </h:body>
</html>
