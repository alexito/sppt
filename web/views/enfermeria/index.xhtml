<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">

  <h:body>
    <ui:composition template="../templates/enfermeria_template.xhtml">
      <ui:define name="main-body">
        <h:form id="form-main-data">          

          <p:tabView id="tabview" dynamic="true" cache="false" effect="drop" effectDuration="fast">

            <p:tab title="Solicitudes" id="tab1">

              <p:dataTable id="table-solicitudes" var="solicitud" value="#{solicitudBean.listaSolicitudesEnfermeriaXAprobar}" rowKey="#{solicitud}"
                           paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                           editable="true"  paginator="true" rows="20"   rowsPerPageTemplate="20,30,40,50,100,1000"
                           widgetVar="solicitudTable"  emptyMessage="No se encontraron solicitudes pendientes." >

                <p:ajax oncomplete="cmdRefreshSolicitudes()" event="rowEdit" listener="#{solicitudBean.onRowEdit}"/>
                <p:ajax event="rowEditCancel" listener="#{solicitudBean.onRowCancel}" />

                <p:column headerText="ID" sortBy="#{solicitud.id}" width="40">  
                  <h:outputText value="#{solicitud.id}" />
                </p:column>
                
                <p:column  width="80" filterBy="#{solicitud.distanciaById.localidadByIdOrigen.nombre}" sortBy="#{solicitud.distanciaById.localidadByIdOrigen.nombre}" headerText="Origen" filterMatchMode="contains" style="vertical-align: top;">  
                  <p:cellEditor>
                    <f:facet name="output">
                      <h:outputText value="#{solicitud.distanciaById.localidadByIdOrigen.nombre}" style="font-weight: bold" />
                      <div style="width: 100%; height: 2px; display: block; border-bottom: 1px dashed #dddddd;"></div>
                      <h:outputText value="#{solicitud.direccionOrigen}" style="font-size: 11.5px; color: dimgrey; margin-top: 5px;" />
                    </f:facet>
                    <f:facet name="input">                  
                      <p:selectOneMenu filter="true" filterMatchMode="contains" id="origen" value="#{solicitud.distanciaById.localidadByIdOrigen.id}" style="width: 100%;">
                        <f:selectItems value="#{solicitudBean.listaLocalidades}" />                    
                      </p:selectOneMenu>
                      <p:inputTextarea id="dorigen" value="#{solicitud.direccionOrigen}" style="width:100%" />
                    </f:facet>
                  </p:cellEditor>
                </p:column>

                <p:column width="80" filterBy="#{solicitud.distanciaById.localidadByIdDestino.nombre}" sortBy="#{solicitud.distanciaById.localidadByIdDestino.nombre}" headerText="Destino" filterMatchMode="contains" style="vertical-align: top;">  
                  <p:cellEditor>
                    <f:facet name="output">
                      <h:outputText value="#{solicitud.distanciaById.localidadByIdDestino.nombre}" style="font-weight: bold" />                      
                      <div style="width: 100%; height: 2px; display: block; border-bottom: 1px dashed #dddddd;"></div>                      
                      <h:outputText value="#{solicitud.direccionDestino}" style="font-size: 11.5px; color: dimgrey; margin-top: 5px;" />                      
                    </f:facet>
                    <f:facet name="input">                  
                      <p:selectOneMenu filter="true" filterMatchMode="contains" id="destino" value="#{solicitud.distanciaById.localidadByIdDestino.id}" style="width: 100%;">
                        <f:selectItems value="#{solicitudBean.listaLocalidades}" />                        
                      </p:selectOneMenu>
                      <p:inputTextarea id="ddestino" value="#{solicitud.direccionDestino}" style="width:100%" />
                    </f:facet>
                  </p:cellEditor>
                </p:column>
                
                <p:column headerText="Distancia" width="50">  
                  <h:outputText value="#{solicitud.distanciaById.distancia}" />
                </p:column>

                <p:column filterBy="#{solicitud.FSalida}" sortBy="#{solicitud.FSalida}" headerText="Fecha y Hora de salida">                   
                  <p:cellEditor>
                    <f:facet name="output">
                      <h:outputText value="#{solicitud.FSalida}">
                        <f:convertDateTime pattern="dd-MM-yyyy HH:mm" timeZone="GMT-5" />
                      </h:outputText>
                    </f:facet>
                    <f:facet name="input"> 
                      <p:calendar id="fsalida" value="#{solicitud.FSalida}" pattern="MM/dd/yyyy HH:mm" />
                    </f:facet>
                  </p:cellEditor>
                </p:column>

                <p:column filterBy="#{solicitud.FLlegada}" sortBy="#{solicitud.FLlegada}" headerText="Fecha y Hora de llegada">                    
                  <p:cellEditor>
                    <f:facet name="output">
                      <h:outputText value="#{solicitud.FLlegada}">
                        <f:convertDateTime pattern="dd-MM-yyyy HH:mm" timeZone="GMT-5" />
                      </h:outputText>
                    </f:facet>
                    <f:facet name="input"> 
                      <p:calendar id="fllegada" value="#{solicitud.FLlegada}" pattern="MM/dd/yyyy HH:mm" />
                    </f:facet>
                  </p:cellEditor>
                </p:column>

                <p:column filterBy="#{solicitud.novedades}"  headerText="Novedades" filterMatchMode="contains">  
                  <p:cellEditor>
                    <f:facet name="output"><h:outputText value="#{solicitud.novedades}" /></f:facet>
                    <f:facet name="input">
                      <p:inputTextarea id="novedades" value="#{solicitud.novedades}" style="width:100%">
                      </p:inputTextarea>                
                    </f:facet>
                  </p:cellEditor>
                </p:column>

                <p:column headerText="Estado (Aprobador)" >
                  <h:outputText value="#{solicitud.estado_legible}" />
                </p:column>
                
                <p:column headerText="Estado (Enfermeria)" >
                  <p:cellEditor>
                    <f:facet name="output"><h:outputText value="#{solicitud.estadoEnfermeria_legible }" /></f:facet>
                    <f:facet name="input"><p:selectBooleanCheckbox value="#{solicitud.estadoEnfermeria}" style="margin-left: 45%" /></f:facet>
                  </p:cellEditor>
                </p:column>

                <p:column filterBy="#{solicitud.usuarioByIdUsuarioConductor.apellido}" sortBy="#{solicitud.usuarioByIdUsuarioConductor.apellido}" headerText="Conductor" filterMatchMode="contains">  
                  <p:cellEditor>
                    <f:facet name="output">
                      <h:outputText value="#{solicitud.usuarioByIdUsuarioConductor.apellido}" />
                      <p:spacer width="5"/>
                      <h:outputText value="#{solicitud.usuarioByIdUsuarioConductor.nombre}" />
                    </f:facet>
                    <f:facet name="input">                  
                      <p:selectOneMenu filter="true" filterMatchMode="contains" id="conductor" value="#{solicitud.usuarioByIdUsuarioConductor.id}" style="width: 100%;">
                        <f:selectItems value="#{solicitudBean.listaConductores}" />                    
                      </p:selectOneMenu>
                    </f:facet>
                  </p:cellEditor>
                </p:column>
                
                <p:column filterBy="#{solicitud.usuarioByIdUsuarioConductor.FDisponible}" sortBy="#{solicitud.usuarioByIdUsuarioConductor.FDisponible}" headerText="Fecha y Hora Disponible">                   
                  <p:cellEditor>
                    <f:facet name="output">
                      <h:outputText value="#{solicitud.usuarioByIdUsuarioConductor.FDisponible}">
                        <f:convertDateTime pattern="dd-MM-yyyy HH:mm" timeZone="GMT-5" />
                      </h:outputText>
                    </f:facet>
                    <f:facet name="input"> 
                      <p:calendar id="fdisponible" value="#{solicitud.usuarioByIdUsuarioConductor.FDisponible}" pattern="MM/dd/yyyy HH:mm" />
                    </f:facet>
                  </p:cellEditor>
                </p:column>
                
                <p:column width="75" filterBy="#{solicitud.usuarioByIdUsuarioSolicita.apellido}" sortBy="#{solicitud.usuarioByIdUsuarioSolicita.apellido}" headerText="Solicitado por:" filterMatchMode="contains">  
                  <h:outputText value="#{solicitud.usuarioByIdUsuarioSolicita.apellido}" />
                      <p:spacer width="5"/>
                      <h:outputText value="#{solicitud.usuarioByIdUsuarioSolicita.nombre}" />
                </p:column>
                
                <p:column width="75" filterBy="#{solicitud.FCreacion}" sortBy="#{solicitud.FCreacion}" headerText="F Creado">  
                  <h:outputText value="#{solicitud.FCreacion}">
                    <f:convertDateTime pattern="dd-MM-yyyy HH:mm" timeZone="GMT-5" />
                  </h:outputText>
                </p:column>

                <p:column style="width:50px"> 
                  <p:rowEditor id="editrow" /> 
                </p:column> 
              </p:dataTable>  

            </p:tab>
          </p:tabView>
        </h:form>  

      </ui:define>
    </ui:composition>
  </h:body>
</html>
