<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">

  <h:body>
    <ui:composition template="../templates/admin_template.xhtml">
      <ui:define name="main-body">
        <h:form id="form">  
          <p:growl id="msgs" showDetail="true"/>

          <p:menubar>
            <p:submenu label="Administrar">              
              <p:menuitem icon="ui-icon-person" value="Usuarios" url="/views/super/usuarios.jspx" />
              <p:menuitem icon="ui-icon-copy" value="Conductores" url="/views/super/conductores.jspx" />
              <p:menuitem icon="ui-icon-key" value="Cambiar clave" url="/administration/CambiarPassword/CambiarPassword.jspx" />
            </p:submenu>
            <p:menuitem icon="ui-icon-check" value="Nueva Solicitud"  onclick="PF('newSolicitud').show();" />
            <f:facet name="options">
              <p:commandButton type="button" value="Salir" icon="ui-icon-extlink" />
            </f:facet>
          </p:menubar>
          
          <p:dataTable id="Solicitudes" var="solicitud" value="#{solicitudBean.listaSolicitudes}" rowKey="#{solicitud}"
                       paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                       editable="true"  paginator="true" rows="10"   rowsPerPageTemplate="10,20,30,40,50,100,1000"
                       widgetVar="solicitudTable"  emptyMessage="No se encontraron datos." >
            
            <p:ajax event="rowEdit" listener="#{solicitudBean.onRowEdit}" update=":form:Solicitudes" />
            <p:ajax event="rowEditCancel" listener="#{solicitudBean.onRowCancel}" update=":form:Solicitudes" />
            
            <f:facet name="header">  
              FILTROS

            </f:facet>  
            
            <p:column headerText="ID" sortBy="#{solicitud.id}" width="50">  
              <h:outputText value="#{solicitud.id}" />
            </p:column>
            
            <p:column filterBy="#{solicitud.localidadByOrigen.nombre}" sortBy="#{solicitud.localidadByOrigen.nombre}" headerText="Origen" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{solicitud.localidadByOrigen.nombre}" /></f:facet>
                <f:facet name="input">                  
                  <p:selectOneMenu id="origen" value="#{solicitud.localidadByOrigen.id}" style="width: 100%;">
                    <f:selectItems value="#{solicitudBean.listaLocalidades}" />                    
                  </p:selectOneMenu>
                </f:facet>
              </p:cellEditor>
            </p:column>
            
            <p:column filterBy="#{solicitud.localidadByDestino.nombre}" sortBy="#{solicitud.localidadByDestino.nombre}" headerText="Destino" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{solicitud.localidadByDestino.nombre}" /></f:facet>
                <f:facet name="input">                  
                  <p:selectOneMenu id="destino" value="#{solicitud.localidadByDestino.id}" style="width: 100%;">
                    <f:selectItems value="#{solicitudBean.listaLocalidades}" />                    
                  </p:selectOneMenu>
                </f:facet>
              </p:cellEditor>
            </p:column>
            
            <p:column filterBy="#{solicitud.FSalida}" sortBy="#{solicitud.FSalida}" headerText="F Salida">  
              <p:cellEditor>
                <f:facet name="output">
                  <h:outputText value="#{solicitud.FSalida}">
                    <f:convertDateTime pattern="dd-MM-yyyy HH:mm" timeZone="GMT-5" />
                  </h:outputText>
                </f:facet>
                <f:facet name="input"> 
                  <p:calendar id="fsalida" value="#{solicitud.FSalida}" pattern="MM/dd/yyyy HH:mm" />
                </f:facet>
              </p:cellEditor>
            </p:column>
            
            <p:column filterBy="#{solicitud.FLlegada}" sortBy="#{solicitud.FLlegada}" headerText="F Llegada">  
              <p:cellEditor>
                <f:facet name="output">
                  <h:outputText value="#{solicitud.FLlegada}">
                    <f:convertDateTime pattern="dd-MM-yyyy HH:mm" timeZone="GMT-5" />
                  </h:outputText>
                </f:facet>
                <f:facet name="input"> 
                  <p:calendar id="fllegada" value="#{solicitud.FLlegada}" pattern="MM/dd/yyyy HH:mm" />
                </f:facet>
              </p:cellEditor>
            </p:column>
            
            <p:column filterBy="#{solicitud.hospedaje}"  headerText="Hospedaje" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{solicitud.hospedaje}" /></f:facet>
                <f:facet name="input">
                  <p:inputText id="hospedaje" value="#{solicitud.hospedaje}" style="width:100%">
                    <f:validateLength minimum="7" />
                    <p:ajax update="msgHospedaje" event="keyup" />
                  </p:inputText>                
                  <p:message for="hospedaje" id="msgHospedaje" display="icon" />
                </f:facet>
              </p:cellEditor>
            </p:column>
            
            <p:column filterBy="#{solicitud.novedades}"  headerText="Novedades" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{solicitud.novedades}" /></f:facet>
                <f:facet name="input">
                  <p:inputText id="novedades" value="#{solicitud.novedades}" style="width:100%">
                    <f:validateLength minimum="7" />
                    <p:ajax update="msgNovedades" event="keyup" />
                  </p:inputText>                
                  <p:message for="novedades" id="msgNovedades" display="icon" />
                </f:facet>
              </p:cellEditor>
            </p:column>
            
            <p:column headerText="Estado" sortBy="#{solicitud.estado_legible}" width="60">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{solicitud.estado_legible}" /></f:facet>
                <f:facet name="input"><p:selectBooleanCheckbox value="#{solicitud.estado}" style="margin-left: 45%" /></f:facet>
              </p:cellEditor>
            </p:column>
            
            <p:column filterBy="#{solicitud.usuarioByIdUsuarioSolicita.nombre}" sortBy="#{solicitud.usuarioByIdUsuarioSolicita.nombre}" headerText="Solicitado por:" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{solicitud.usuarioByIdUsuarioSolicita.nombre}" /></f:facet>
                <f:facet name="input">                  
                  <p:selectOneMenu id="solicita" value="#{solicitud.usuarioByIdUsuarioSolicita.id}" style="width: 100%;">
                    <f:selectItems value="#{solicitudBean.listaUsuarios}" />                    
                  </p:selectOneMenu>
                </f:facet>
              </p:cellEditor>
            </p:column>
            
            <p:column filterBy="#{solicitud.usuarioByIdUsuarioConductor.nombre}" sortBy="#{solicitud.usuarioByIdUsuarioConductor.nombre}" headerText="Conductor" filterMatchMode="contains">  
              <p:cellEditor>
                <f:facet name="output"><h:outputText value="#{solicitud.usuarioByIdUsuarioConductor.nombre}" /></f:facet>
                <f:facet name="input">                  
                  <p:selectOneMenu id="conductor" value="#{solicitud.usuarioByIdUsuarioConductor.id}" style="width: 100%;">
                    <f:selectItems value="#{solicitudBean.listaUsuarios}" />                    
                  </p:selectOneMenu>
                </f:facet>
              </p:cellEditor>
            </p:column>

            <p:column filterBy="#{solicitud.usuarioByIdUsuarioCrea.nombre}" sortBy="#{solicitud.usuarioByIdUsuarioCrea.nombre}" headerText="Creado por:" filterMatchMode="contains">  
              <h:outputText value="#{solicitud.usuarioByIdUsuarioCrea.nombre}" />
            </p:column>
            
            <p:column style="width:50px"> 
              <p:rowEditor id="editrow" ></p:rowEditor> 
            </p:column> 
          </p:dataTable>  

        </h:form>  
        
        <!-- ________________________   NEW SOLICITUD FORM  ________________________   -->
        
        <p:dialog widgetVar="newSolicitud" header="Ingrese los datos de la Nueva Solicitud"  closeOnEscape="true" draggable="false" resizable="false" showEffect="drop" hideEffect="drop">
          <h:form>          
            <center>
              <p:panel id="pnl" style="margin-bottom:10px;">
                <p:messages id="messages" />
                <h:panelGrid id="grid" columns="3" cellpadding="5">

                  <h:outputLabel for="origen" value="Origen: *" />
                  <p:selectOneMenu id="origen" value="#{solicitudBean.solicitud.localidadByOrigen.id}" style="width: 100%;">
                    <f:selectItems value="#{solicitudBean.listaLocalidades}" />                    
                  </p:selectOneMenu>
                  <br></br>
                  
                  <h:outputLabel for="destino" value="Destino: *" />
                  <p:selectOneMenu id="destino" value="#{solicitudBean.solicitud.localidadByDestino.id}" style="width: 100%;">
                    <f:selectItems value="#{solicitudBean.listaLocalidades}" />                    
                  </p:selectOneMenu>
                  <br></br>
                  
                  <h:outputLabel for="fsalida" value="Fecha Salida: *" />
                  <p:calendar id="fsalida" value="#{solicitud.FSalida}" pattern="MM/dd/yyyy HH:mm" />
                  <br></br>
                  
                  <h:outputLabel for="fllegada" value="Fecha Llegada: *" />
                  <p:calendar id="fllegada" value="#{solicitud.FLlegada}" pattern="MM/dd/yyyy HH:mm" />
                  <br></br>
                  
                  <h:outputLabel for="hospedaje" value="Hospedaje: *" />
                  <p:inputTextarea id="hospedaje" value="#{solicitud.hospedaje}" style="width:100%">
                    <f:validateLength minimum="7" />
                    <p:ajax update="msgHospedaje" event="keyup" />
                  </p:inputTextarea>                
                  <p:message for="hospedaje" id="msgHospedaje" display="icon" />

                  <h:outputLabel for="novedades" value="Novedades: *" />
                  <p:inputTextarea id="novedades" value="#{solicitud.novedades}" style="width:100%">
                    <f:validateLength minimum="7" />
                    <p:ajax update="msgNovedades" event="keyup" />
                  </p:inputTextarea>                
                  <p:message for="novedades" id="msgNovedades" display="icon" />
                  
                  <h:outputLabel for="estado" value="Estado: *" />
                  <p:selectBooleanCheckbox id="estado" value="#{solicitud.estado}" style="margin-left: 45%" />
                  <br></br>
                  
                  <h:outputLabel for="solicita" value="Solicita: *" />
                  <p:selectOneMenu id="solicita" value="#{solicitudBean.solicitud.usuarioByIdUsuarioSolicita.id}" style="width: 100%;">
                    <f:selectItems value="#{solicitudBean.listaUsuarios}" />                    
                  </p:selectOneMenu>
                  <br></br>
                  
                  <h:outputLabel for="conductor" value="Conductor: *" />
                  <p:selectOneMenu id="conductor" value="#{solicitudBean.solicitud.usuarioByIdUsuarioConductor.id}" style="width: 100%;">
                    <f:selectItems value="#{solicitudBean.listaUsuarios}" />                    
                  </p:selectOneMenu>
                  <br></br>

                </h:panelGrid>
                <f:facet name="footer">
                  <center>
                    <p:commandButton ajax="true" update="grid" validateClient="true" value="Guardar"  action="#{solicitudBean.saveSolicitud()}"/>
                  </center>
                </f:facet> 
              </p:panel>
            </center>
          </h:form>
        </p:dialog>

      </ui:define>
    </ui:composition>
  </h:body>
</html>
